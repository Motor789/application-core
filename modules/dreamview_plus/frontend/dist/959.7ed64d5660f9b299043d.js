"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[959],{12500:(e,n,t)=>{t.r(n),t.d(n,{default:()=>M});var i=t(22590),r=t.n(i),l=t(20675),a=t(54067),o=t(80151),u=t(58938),c=t(16125),s=t(85404),b=t(56733),f=t(79424),d=t(51999),y=t(52007),p=t(4492),v=t(36469),m={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!0,currentVisible:!0,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!0,currentVisible:!0,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"cameraSensor"},v2x:{defaultVisible:!0,currentVisible:!0,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!1,currentVisible:!1,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!1,currentVisible:!1,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectory:{defaultVisible:!1,currentVisible:!1,vizKey:"planningTrajectory"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!1,currentVisible:!1,vizKey:"crosswalk"},clearArea:{defaultVisible:!1,currentVisible:!1,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!1,currentVisible:!1,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!1,currentVisible:!1,vizKey:"signal"},stopSign:{defaultVisible:!1,currentVisible:!1,vizKey:"stopSign"},yieldSign:{defaultVisible:!1,currentVisible:!1,vizKey:"yieldSign"},speedBump:{defaultVisible:!1,currentVisible:!1,vizKey:"speedBump"},parkingSpace:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},V=function(e){var n={};return Object.keys(e).forEach((function(t){var i=e[t];Object.keys(i).forEach((function(e){var r=i[e];n[t]=n[t]||{},n[t][r.vizKey]=r.currentVisible}))})),n},g=new v.mM(v.SA.PointCloudLayerMenu),h=function(){return g.get()||m},z=t(27140);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function K(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?K(Object(t),!0).forEach((function(n){E(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):K(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function E(e,n,t){var i;return i=function(e,n){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=S(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==S(i)?i:String(i))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function O(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return C(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?C(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function P(e){var n=(0,b.Z)().classes,t=e.carviz,o=e.obstacleChannels,u=e.updateObstacleChannel,c=e.closeChannel,s=e.showPerception,f=e.setShowPerception,d=e.curChannel,y=e.setCurChannel,p=(0,a.$G)("layerMenu").t,v=(0,a.$G)("panels").t,m=h();g.set(m),t.option.updateLayerOption(V(m),"pointCloud");var S=O((0,i.useState)(m),2),K=S[0],C=S[1],P=O((0,i.useState)(Object.keys(K)),1)[0],j=O((0,i.useState)(P[0]),1)[0],k=O((0,i.useState)(K[j]),2)[1];return r().createElement("div",{className:n["layer-menu-container"]},r().createElement("div",{className:n["layer-menu-header"]},r().createElement("div",{className:n["layer-menu-header-left"]},v("layerMenu"))),r().createElement("div",{className:n["layer-menu-content"]},r().createElement("div",{className:n["layer-menu-content-left"]},r().createElement("span",{className:n["layer-menu-content-right-switch"],style:{display:"inline-block",marginTop:"6px"}},r().createElement(l.XZ,{checked:s,defaultChecked:!0,onChange:function(e){e.target.checked&&o.length?(f(!0),u(d)):(f(!1),c())}})),p("perception")),r().createElement("div",{className:n["layer-menu-content-right"]},r().createElement(z.Z,{value:d,options:o,onChange:function(e){return function(e){y(e),u(e)}(e)}}),r().createElement("div",{className:n["layer-menu-horizontal-line"]}),r().createElement("li",{className:n["layer-menu-content-right-li"]},r().createElement("span",{className:n["layer-menu-content-right-switch"]},r().createElement(l.Y8,{checked:K.Perception.polygon.currentVisible,onChange:function(e){if(e.target.checked){var n=w(w({},K.Perception),{},{polygon:w(w({},K.Perception.polygon),{},{currentVisible:!0}),boundingbox:w(w({},K.Perception.boundingbox),{},{currentVisible:!1})}),i=w(w({},K),{},E({},j,n));k((function(){return n})),C((function(){return i})),t.option.updateLayerOption(V(i),"vehicle"),g.set(i)}}})),r().createElement("span",{className:n["layer-menu-content-right-label"]},p("polygon"))),r().createElement("li",{className:n["layer-menu-content-right-li"]},r().createElement("span",{className:n["layer-menu-content-right-switch"]},r().createElement(l.Y8,{checked:K.Perception.boundingbox.currentVisible,onChange:function(e){if(e.target.checked){var n=w(w({},K.Perception),{},{polygon:w(w({},K.Perception.polygon),{},{currentVisible:!1}),boundingbox:w(w({},K.Perception.boundingbox),{},{currentVisible:!0})}),i=w(w({},K),{},E({},j,n));k((function(){return n})),C((function(){return i})),t.option.updateLayerOption(V(i),"vehicle"),g.set(i)}}})),r().createElement("span",{className:n["layer-menu-content-right-label"]},p("boundingbox"))))))}function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function k(e,n,t){var i;return i=function(e,n){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=j(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==j(i)?i:String(i))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function D(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return N(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?N(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function I(){var e=D((0,i.useState)(!0),2),n=e[0],t=e[1],p=D((0,i.useState)(null),2),v=p[0],m=p[1],z=(0,y.R)(),S=D((0,o.Mq)(),1)[0],K=z.initSubscription,w=z.setKeyDownHandlers,E=z.removeKeyDownHandlers,O=(0,b.Z)().classes,C=D((0,i.useState)("D"),2),j=C[0],N=C[1],I=D((0,s.Z)(),2),A=I[0],M=I[1],L=(0,a.$G)("panels").t,T=D((0,i.useState)(null),2),x=T[0],U=T[1],Z=(0,c.Z)(),R=Z.metadata,$=Z.isMainConnected,J=Z.streamApi,_=(0,i.useRef)(null),G=(0,i.useMemo)((function(){return R.find((function(e){return"obstacle"===e.dataName}))}),[R,$]),H=(0,i.useMemo)((function(){return G?G.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[G]),W=function(){null==A||A.updateData({object:[],autoDrivingCar:{}}),_.current&&_.current.subscription&&(_.current.subscription.unsubscribe(),_.current=null)},q=function(e){W();var n=J.subscribeToDataWithChannel("obstacle",e).subscribe((function(e){var n={CopyAutoDrivingCar:e.autoDrivingCar,object:e.obstacle||[]};null==A||A.updateData(n)}));_.current={name:"obstacle",subscription:n}};(0,i.useEffect)((function(){A.init();var e=h();g.set(e),A.option.updateLayerOption(V(e),"pointCloud")}),[]),(0,i.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(-10)},discriptor:L("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(-10)},discriptor:L("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(10)},discriptor:L("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(10)},discriptor:L("zoomOut")}];return w(e),function(){E(e)}}),[L]),(0,i.useEffect)((function(){if(H&&0!==H.length&&J){var e=H[0];m(e.value),n&&q(e.value)}}),[H,J]),(0,i.useEffect)((function(){return function(){var e;null===(e=_.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]),(0,i.useEffect)((function(){K(k(k({},u.DU.SIM_WORLD,{consumer:function(e){A.adc.updateOffset(e.autoDrivingCar,"adc")}}),u.DU.POINT_CLOUD,{consumer:function(e){U(e)}}))}),[]),(0,i.useEffect)((function(){x&&(null==A||A.updatePointCloud(x))}),[x]);var B=(0,i.useRef)(0),F=function e(){null==A||A.render(),B.current=requestAnimationFrame(e)};(0,i.useEffect)((function(){return F(),function(){var e=B.current;e&&cancelAnimationFrame(e)}}),[]),(0,i.useEffect)((function(){U(null),null==A||A.removeAll()}),[S.currentRecordId]);var Y=r().createElement(P,{curChannel:v,setCurChannel:m,carviz:A,obstacleChannels:H,updateObstacleChannel:q,closeChannel:W,showPerception:n,setShowPerception:t});return r().createElement("div",{className:O["viz-container"]},r().createElement("div",{id:M,className:O["web-gl"]}),r().createElement("div",{className:O["viz-btn-container"]},r().createElement(d.Z,{from:"PointCloud",carviz:A},r().createElement(l.J2,{placement:"leftTop",trigger:"click",content:Y},r().createElement("span",{className:O["viz-btn-item"]},r().createElement(l.Le,null))),r().createElement(l.J2,{placement:"leftTop",content:r().createElement(f.Z,{carviz:A,setCurrentView:N}),trigger:"click"},r().createElement("span",{className:O["viz-btn-item"]},null==j?void 0:j.charAt(0))))))}function A(e){var n=(0,i.useMemo)((function(){return(0,p.Z)({PanelComponent:I,panelId:e.panelId,subscribeInfo:[{name:u.DU.POINT_CLOUD,needChannel:!0},{name:u.DU.SIM_WORLD,needChannel:!1}]})}),[]);return r().createElement(n,e)}I.displayName="PointCloud";const M=r().memo(A)}}]);